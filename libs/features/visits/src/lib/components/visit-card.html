<!-- Visit Card - Tappable card displaying brewery/winery visit information -->
<article
  class="group relative overflow-hidden rounded-2xl bg-gradient-to-br from-base-100 to-base-200 shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1 active:scale-[0.98] cursor-pointer"
  role="article"
  [attr.aria-label]="'Visit to ' + (venue?.name || 'Unknown Venue') + (visit.is_active ? ', currently here' : '')"
  tabindex="0"
>
  <!-- Active Visit Glow Effect -->
  @if (visit.is_active) {
    <div class="absolute inset-0 bg-gradient-to-br from-success/10 to-success/5 animate-pulse pointer-events-none" aria-hidden="true"></div>
  }

  <!-- Card Content -->
  <div class="relative p-5">
    <!-- Top Row: Venue Type Icon + Name + Source Badge -->
    <div class="flex items-start gap-3">
      <!-- Venue Type Icon Container -->
      <div
        class="flex-shrink-0 flex items-center justify-center w-12 h-12 rounded-xl shadow-sm"
        [ngClass]="{
          'bg-gradient-to-br from-amber-500/20 to-amber-600/10 text-amber-600': venue?.venue_type === 'brewery',
          'bg-gradient-to-br from-purple-500/20 to-purple-600/10 text-purple-600': venue?.venue_type === 'winery',
          'bg-gradient-to-br from-base-300 to-base-200 text-base-content/50': !venue?.venue_type
        }"
        [attr.aria-label]="venue?.venue_type === 'brewery' ? 'Brewery' : venue?.venue_type === 'winery' ? 'Winery' : 'Venue'"
      >
        @if (venue?.venue_type === 'brewery') {
          <ng-icon name="heroBeaker" size="24" class="drop-shadow-sm" />
        } @else if (venue?.venue_type === 'winery') {
          <ng-icon name="heroSparkles" size="24" class="drop-shadow-sm" />
        } @else {
          <ng-icon name="heroMapPin" size="24" class="drop-shadow-sm" />
        }
      </div>

      <!-- Venue Info -->
      <div class="flex-1 min-w-0">
        <!-- Venue Name -->
        <h3 class="text-lg font-semibold text-base-content leading-tight truncate pr-16 group-hover:text-primary transition-colors">
          {{ venue?.name || 'Unknown Venue' }}
        </h3>

        <!-- Location -->
        @if (venue?.city || venue?.state) {
          <p class="flex items-center gap-1.5 mt-1 text-sm text-base-content/60">
            <ng-icon name="heroMapPin" size="14" class="flex-shrink-0" aria-hidden="true" />
            <span class="truncate">{{ getLocation() }}</span>
          </p>
        }
      </div>

      <!-- Source Badge (positioned top right) -->
      @if (visit.source) {
        <div class="absolute top-4 right-4">
          <span
            class="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-base-300/80 text-base-content/70 backdrop-blur-sm"
            [attr.aria-label]="'Source: ' + getSourceLabel(visit.source)"
          >
            @if (visit.source === 'google_import') {
              <ng-icon name="heroMapPin" size="12" aria-hidden="true" />
            } @else if (visit.source === 'manual') {
              <ng-icon name="heroCheckCircle" size="12" aria-hidden="true" />
            } @else if (visit.source === 'auto_detect') {
              <ng-icon name="heroSignal" size="12" aria-hidden="true" />
            }
            <span class="hidden sm:inline">{{ getSourceLabel(visit.source) }}</span>
          </span>
        </div>
      }
    </div>

    <!-- Divider -->
    <div class="my-4 border-t border-base-300/50" aria-hidden="true"></div>

    <!-- Time and Duration Row -->
    <div class="flex flex-wrap items-center gap-x-4 gap-y-2">
      <!-- Arrival Time - Primary emphasis -->
      <div class="flex items-center gap-2" aria-label="Arrival time">
        <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-primary/10 text-primary">
          <ng-icon name="heroClock" size="18" aria-hidden="true" />
        </div>
        <div>
          <p class="text-xs text-base-content/50 uppercase tracking-wide font-medium">Arrived</p>
          <p class="text-sm font-semibold text-base-content">{{ formatTime(visit.arrival_time) }}</p>
        </div>
      </div>

      <!-- Departure Time (if exists) -->
      @if (visit.departure_time) {
        <div class="flex items-center gap-2 text-base-content/70" aria-hidden="true">
          <span class="text-base-content/30">-</span>
        </div>
        <div class="flex items-center gap-2" aria-label="Departure time">
          <div>
            <p class="text-xs text-base-content/50 uppercase tracking-wide font-medium">Left</p>
            <p class="text-sm font-medium text-base-content/80">{{ formatTime(visit.departure_time) }}</p>
          </div>
        </div>
      }

      <!-- Duration Badge (if complete) -->
      @if (getDuration()) {
        <div class="ml-auto">
          <div
            class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gradient-to-r from-info/10 to-info/5 text-info border border-info/20"
            aria-label="Visit duration"
          >
            <ng-icon name="heroBolt" size="14" aria-hidden="true" />
            <span class="text-sm font-semibold">{{ getDuration() }}</span>
          </div>
        </div>
      }
    </div>

    <!-- Active Visit Badge -->
    @if (visit.is_active) {
      <div class="mt-4">
        <div
          class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-success to-success/80 text-success-content shadow-lg shadow-success/25"
          role="status"
          aria-live="polite"
        >
          <span class="relative flex h-2.5 w-2.5">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-success-content/75"></span>
            <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-success-content"></span>
          </span>
          <span class="text-sm font-semibold tracking-wide">Currently Here</span>
        </div>
      </div>
    }

  </div>

  <!-- Bottom Accent Bar -->
  <div
    class="h-1 w-full"
    [ngClass]="{
      'bg-gradient-to-r from-amber-500 via-amber-400 to-amber-500': venue?.venue_type === 'brewery',
      'bg-gradient-to-r from-purple-500 via-purple-400 to-purple-500': venue?.venue_type === 'winery',
      'bg-gradient-to-r from-base-300 via-base-200 to-base-300': !venue?.venue_type
    }"
    aria-hidden="true"
  ></div>
</article>
