<!-- Visit Detail Page -->
<div class="min-h-screen bg-base-100">
  <!-- Loading state -->
  @if (isLoading()) {
    <div class="flex flex-col items-center justify-center min-h-screen">
      <span class="loading loading-spinner loading-lg"></span>
      <p class="mt-4 text-sm text-base-content/70">Loading visit details...</p>
    </div>
  }

  <!-- Error state -->
  @if (error()) {
    <div class="flex flex-col items-center justify-center min-h-screen px-4">
      <ng-icon name="heroExclamationCircle" size="80" class="text-error" />
      <h2 class="mt-6 text-2xl font-semibold text-center">{{ error() }}</h2>
      <button class="mt-6 btn btn-primary" (click)="goBack()">
        <ng-icon name="heroArrowLeft" size="20" />
        Go Back
      </button>
    </div>
  }

  <!-- Visit details -->
  @if (!isLoading() && !error() && visit()) {
    <!-- Header Bar -->
    <div class="sticky top-0 z-10 border-b bg-base-200/80 backdrop-blur-lg border-base-300">
      <div class="max-w-4xl px-4 py-3 mx-auto">
        <div class="flex items-center justify-between">
          <button class="gap-2 btn btn-ghost btn-sm" (click)="goBack()">
            <ng-icon name="heroArrowLeft" size="20" />
            Back
          </button>

          <div class="flex gap-2">
            <button class="btn btn-sm btn-ghost" (click)="shareVisit()" title="Share visit">
              <ng-icon name="heroShare" size="20" />
            </button>
            <button class="btn btn-sm btn-ghost text-error" (click)="deleteVisit()" title="Delete visit">
              <ng-icon name="heroTrash" size="20" />
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-4xl px-4 py-8 mx-auto space-y-6">

      <!-- Venue Hero Card -->
      <div class="overflow-hidden shadow-xl card bg-gradient-to-br from-primary/10 to-secondary/10">
        <div class="card-body">
          <div class="flex flex-wrap items-start justify-between gap-4">
            <div class="flex-1 min-w-0">
              @if (isActive()) {
                <div class="inline-flex items-center gap-2 px-3 py-1 mb-3 text-sm font-medium rounded-full bg-success/20 text-success">
                  <span class="w-2 h-2 rounded-full animate-pulse bg-success"></span>
                  Active Visit
                </div>
              }

              <h1 class="mb-2 text-4xl font-bold break-words">
                {{ venue()?.name || 'Unknown Venue' }}
              </h1>

              @if (venue()) {
                <div class="flex flex-wrap items-center gap-2 mt-3">
                  <div class="gap-2 badge badge-primary badge-lg">
                    {{ venue()!.venue_type === 'brewery' ? 'üç∫ Brewery' : 'üç∑ Winery' }}
                  </div>
                </div>

                <div class="mt-4 space-y-2">
                  <div class="flex items-start gap-2 text-base-content/70">
                    <ng-icon name="heroMapPin" size="20" class="shrink-0 mt-0.5" />
                    <div>
                      <p class="font-medium">{{ venue()!.city }}, {{ venue()!.state_province }}</p>
                      @if (venue()!.address) {
                        <p class="text-sm text-base-content/60">{{ venue()!.address }}</p>
                      }
                    </div>
                  </div>
                </div>

                <button class="gap-2 mt-6 btn btn-primary" (click)="openInMaps()">
                  <ng-icon name="heroMap" size="20" />
                  Open in Maps
                </button>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Visit Timeline -->
      <div class="shadow-xl card bg-base-200">
        <div class="card-body">
          <h2 class="mb-6 text-2xl font-bold card-title">Visit Timeline</h2>

          <div class="space-y-6">
            <!-- Arrival -->
            <div class="flex items-start gap-4">
              <div class="flex items-center justify-center w-12 h-12 rounded-full shrink-0 bg-success/20">
                <ng-icon name="heroArrowRightOnRectangle" size="24" class="text-success" />
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium text-base-content/60">Arrived</div>
                <div class="mt-1 text-xl font-semibold">{{ formattedArrival() }}</div>
              </div>
            </div>

            <!-- Departure or In Progress -->
            @if (!isActive()) {
              <div class="flex items-start gap-4">
                <div class="flex items-center justify-center w-12 h-12 rounded-full shrink-0 bg-error/20">
                  <ng-icon name="heroArrowLeftOnRectangle" size="24" class="text-error" />
                </div>
                <div class="flex-1">
                  <div class="text-sm font-medium text-base-content/60">Departed</div>
                  <div class="mt-1 text-xl font-semibold">{{ formattedDeparture() }}</div>
                </div>
              </div>

              <!-- Duration -->
              @if (visit()!.duration_minutes) {
                <div class="flex items-start gap-4">
                  <div class="flex items-center justify-center w-12 h-12 rounded-full shrink-0 bg-info/20">
                    <ng-icon name="heroClock" size="24" class="text-info" />
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-base-content/60">Duration</div>
                    <div class="mt-1 text-xl font-semibold">{{ visit()!.duration_minutes | duration }}</div>
                  </div>
                </div>
              }
            } @else {
              <div class="p-4 rounded-lg alert alert-info">
                <ng-icon name="heroInformationCircle" size="24" />
                <span class="font-medium">This visit is still in progress</span>
              </div>
            }
          </div>

          <div class="mt-6 divider"></div>

          <div class="flex items-center gap-2 text-sm text-base-content/60">
            <ng-icon name="heroInformationCircle" size="16" />
            <span>Detection: {{ visit()!.detection_method === 'auto' ? 'Automatic' : 'Manual' }}</span>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Share Modal (T201: User Story 4) -->
  <app-share-modal></app-share-modal>
</div>
