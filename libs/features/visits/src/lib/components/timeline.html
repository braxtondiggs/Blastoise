<!-- Timeline with screen reader support -->
<div class="max-w-4xl px-4 pb-6 mx-auto" role="main" aria-label="Visit timeline">
  <!-- Header -->
  <div class="flex items-center justify-between mb-8">
    <h1 class="text-3xl font-bold" id="timeline-heading">Your Visits</h1>
    <button
      class="btn btn-sm btn-ghost"
      (click)="refresh()"
      [disabled]="isLoading()"
      aria-label="Refresh visit timeline"
      [attr.aria-busy]="isLoading()"
    >
      <ng-icon name="heroArrowPath" size="20" aria-hidden="true" />
      Refresh
    </button>
  </div>

  <!-- Empty state -->
  @if (isEmpty()) {
    <div class="flex flex-col items-center justify-center py-16 text-center">
      <ng-icon name="heroMapPin" size="96" class="text-base-content/30" />
      <h2 class="mt-4 text-2xl font-semibold">No visits yet</h2>
      <p class="mt-2 text-base-content/70">
        Your brewery and winery visits will appear here automatically.
      </p>
      <p class="mt-1 text-sm text-base-content/60">
        Make sure location tracking is enabled in your settings.
      </p>
    </div>
  }

  <!-- Timeline with grouped visits -->
  @if (!isEmpty()) {
    <div class="space-y-8" role="feed" aria-labelledby="timeline-heading">
      @for (group of groupedVisits(); track group.date) {
        <!-- Date header -->
        <section [attr.aria-labelledby]="'date-header-' + group.date">
          <div class="mb-4">
            <h2
              [id]="'date-header-' + group.date"
              class="text-xl font-semibold opacity-80"
            >
              {{ group.displayDate }}
            </h2>
            <div class="divider" role="separator"></div>
          </div>

          <!-- Visits for this date -->
          <div
            class="pl-4 space-y-6"
            role="list"
            [attr.aria-label]="'Visits on ' + group.displayDate"
          >
            @for (visit of group.visits; track visit.id) {
              <app-visit-card
                [visit]="visit"
                [venue]="visit.venue"
                (click)="onVisitClick(visit)"
                class="cursor-pointer transition-transform hover:scale-[1.02]"
                role="listitem"
                [attr.aria-label]="'Visit to ' + (visit.venue?.name || 'venue') + ' at ' + (visit.arrival_time | date:'short')"
                tabindex="0"
              />
            }
          </div>
        </section>
      }

      <!-- Loading indicator -->
      @if (isLoading()) {
        <div
          class="flex flex-col items-center justify-center py-8"
          role="status"
          aria-live="polite"
          aria-label="Loading more visits"
        >
          <span class="loading loading-spinner loading-lg" aria-hidden="true"></span>
          <p class="mt-2 text-sm text-base-content/70">Loading more visits...</p>
        </div>
      }

      <!-- End of list indicator -->
      @if (!hasMore() && !isLoading() && !isEmpty()) {
        <div class="flex items-center justify-center py-8">
          <p class="text-sm text-base-content/60">
            You've reached the beginning of your visit history
          </p>
        </div>
      }
    </div>
  }
</div>
